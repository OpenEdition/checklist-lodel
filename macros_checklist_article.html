<CONTENT VERSION="1.0" LANG="fr" CHARSET="utf-8"/>

/**
 * Main article.
 */
<DEFMACRO NAME="CKL_A_MAIN">
  <LOOP NAME="ckl_a_main"
        TABLE="textes"
        WHERE="id=[#ID_ARTICLE]">
    <DO>
      <MACRO NAME="CKL_A_HEADER"/>
      <MACRO NAME="CKL_A_RESUMES"/>
      <MACRO NAME="CKL_A_ENTRIES"/>
      <MACRO NAME="CKL_A_TOC"/>
    </DO>
    <ALTERNATIVE>
      <p>Article [#ID_ARTICLE] not found.</p>
    </ALTERNATIVE>
  </LOOP>
</DEFMACRO>

/**
 * Header.
 */
<DEFMACRO NAME="CKL_A_HEADER">
  ID [#ID]
  <!--[ Numéro de document ]-->
  <IF COND="[#NUMERODOCUMENT] AND [#NUMERODOCUMENT] NE '0'">
    <FUNC NAME="CKL_FIELD_STRING" FIELD="numerodocument" VALUE="[#NUMERODOCUMENT]"/>
  </IF>

  <!--[ Titre du document ]-->
  <FUNC NAME="CKL_FIELD_STRING" FIELD="titre" VALUE="[#TITRE]"/>

  <!--[ Sous-titre du document ]-->
  <FUNC NAME="CKL_FIELD_STRING" FIELD="soustitre" VALUE="[#SOUSTITRE]"/>

  <!--[ Titres alternatifs ]-->
  <FUNC NAME="CKL_FIELD_ML" FIELD="altertitre" VALUE="[#ALTERTITRE]"/>

  <!--[ Auteurs ]-->
  <FUNC NAME="CKL_PERSONNES" TYPE="auteur"/>

  <!--[ Traducteurs ]-->
  <FUNC NAME="CKL_PERSONNES" TYPE="traducteur"/>

  <!--[ Pagination ]-->
  <FUNC NAME="CKL_FIELD_STRING" FIELD="pagination" VALUE="[#PAGINATION]"/>

  <!--[ TODO: Alias de traduction ]-->

  <!-- [ BM ] -->
  <IF COND="[#TYPE] EQ 'article' AND [#DATEPUBLI] GT today()">
		<LET VAR="BM">1</LET>
	</IF>
  <FUNC NAME="CKL_FIELD_BOOL" FIELD="bm" VALUE="[#BM]"/>
</DEFMACRO>

 /**
  * Résumés.
  */
<DEFMACRO NAME="CKL_A_RESUMES">
  <FUNC NAME="CKL_FIELD_ML" FIELD="resume" VALUE="[#RESUME]"/>
</DEFMACRO>

/**
 * Index.
 */
<DEFMACRO NAME="CKL_A_ENTRIES">
  <LOOP NAME="ckl_a_entries_types" TABLE="relations, entries, entrytypes" SELECT="DISTINCT(idtype), title, altertitle, type AS entrytype" WHERE="id1 = '[#ID]' AND id2 = entries.id AND entries.idtype = entrytypes.id AND entrytypes.class = 'indexes'" ORDER="entrytypes.rank">
    <BEFORE>
      <div class="ckl-entries">
    </BEFORE>
    <DO>
      <LOOP NAME="ckl_a_entries" TABLE="entries" SELECT="id, g_name" WHERE="idtype = '[#IDTYPE]' AND iddocument = '[#ID]'" ORDER="degree">
        <BEFORE>
          <div class="ckl-entrytype doc-entrytype-[#ENTRYTYPE]">
        </BEFORE>
        <DO><IF COND="[#COUNT] GE 2">, </IF><a href="[#ID|makeurlwithid]" class="ckl-entry">[#G_NAME]</a></DO>
        <AFTER>
          </div>
        </AFTER>
      </LOOP>
    </DO>
    <AFTER>
      </div>
    </AFTER>
  </LOOP>
</DEFMACRO>

/**
 * Table des matières de l'article.
 */
<DEFMACRO NAME="CKL_A_TOC">
  <IF COND="[#TEXTE]">
    <LET VAR="TOC_PREV_NIVEAU" GLOBAL="1">1</LET>
    <LET VAR="OUVRIR_UL"><li><ul></LET>
    <LET VAR="FERMER_UL"></ul></li></LET>
    <LOOP NAME="toc" TEXT="[#TEXTE]">
      <BEFORE>
        <div class="ckl-toc">
          <ul>
      </BEFORE>
      <DO>
        <LET VAR="ECART">[#NIVEAU|lmath('-', [%TOC_PREV_NIVEAU])]</LET>
        <LET VAR="LIEN"><a href="#tocto[#TOCID]" id="tocfrom[#TOCID]">[#TITRE|removenotes]</a></LET>
          <IF COND="[#ECART] EQ 0">
            <li dir="[#DIR]">[#LIEN]</li>
          <ELSEIF COND="[#ECART] GT 0"/>
            [#OUVRIR_UL|str_repeat([#ECART])]
            <li dir="[#DIR]">[#LIEN]</li>
          <ELSE/>
            [#FERMER_UL|str_repeat([#ECART])]
            <li dir="[#DIR]">[#LIEN]</li>
          </IF>
          <LET VAR="TOC_PREV_NIVEAU" GLOBAL="1">[#NIVEAU]</LET>
        </DO>
        <AFTER>
              <!--[ Fermeture des derniers ul/li ]-->
              <IF COND="[%TOC_PREV_NIVEAU] GT 1">
                [#FERMER_UL|str_repeat([%TOC_PREV_NIVEAU|lmath('-', 1)])]
              </IF>
            </ul>
          </div>
        </AFTER>
    </LOOP>
  </IF>
</DEFMACRO>
