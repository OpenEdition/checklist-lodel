<CONTENT VERSION="1.0" LANG="fr" CHARSET="utf-8"/>

/**
 * Checklist main.
 */
<DEFMACRO NAME="CKL_MAIN">
  <USE MACROFILE="macros_checklist_article.html"/>
  <USE MACROFILE="macros_checklist_index.html"/>
  <USE MACROFILE="macros_checklist_publication.html"/>

  <MACRO NAME="CKL_HTML_START"/>

  <IF COND="[#ID_ARTICLE]">
    <MACRO NAME="CKL_A_MAIN"/>

  <ELSEIF COND="[#ID_PUBLICATION]"/>
    <MACRO NAME="CKL_P_MAIN"/>

  <ELSEIF COND="[#ID_INDEX]"/>
    <MACRO NAME="CKL_I_MAIN"/>

  <ELSE/>
    <p>Id not found.</p>
  </IF>

  <MACRO NAME="CKL_HTML_END"/>
</DEFMACRO>

/**
 * Ouverture de la page HTML.
 */
<DEFMACRO NAME="CKL_HTML_START">
  <!doctype html>
  <html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>OpenEdition Checklist</title>
  </head>
  <body>
</DEFMACRO>

/**
 * Fermeture de la page HTML.
 */
<DEFMACRO NAME="CKL_HTML_END">
  </body>
  </html>
</DEFMACRO>

/**
 * Affichage simple d'un champ.
 * @param {string} field - Nom du champ (détermine le classname).
 * @param {string} value - Valeur à afficher.
 * @param {string} [lang] - Attribut lang.
 * @param {boolean} [force] - Forcer l'affichage, même si [#VALUE] est vide.
 */
<DEFFUNC NAME="CKL_FIELD" REQUIRED="field, value" OPTIONAL="lang, force">
  <IF COND="[#LANG]"><LET VAR="lang_attr">lang="[#LANG]"</LET></IF>
  <IF COND="[#FIELD] AND ([#VALUE] OR [#FORCE])">
    <p class="ckl-field ckl-field-[#FIELD]" [#LANG_ATTR]>[#VALUE]</p>
  </IF>
</DEFFUNC>


/**
 * Affichage des altertitres.
 * @param {string} altertitre - Champ [#ALTERTITRE].
 */
<DEFFUNC NAME="CKL_ALTERTITRES">
  <div class="ckl-altertitres">
    <LET VAR="value">[#ALTERTITRE]</LET>
    <LOOP NAME="mltext">
      <FUNC NAME="CKL_FIELD" FIELD="altertitre" VALUE="[#VALUE]" LANG="[#LANG]"/>
    </LOOP>
  </div>
</DEFFUNC>

/**
 * Affiche les personnes liées à l'entité en cours.
 * @param {string} type - Nom du type des personnes.
 */
<DEFFUNC NAME="CKL_PERSONNES" REQUIRED="type">
	<LOOP NAME="ckl_personnes" SELECT="g_firstname, g_familyname" TABLE="relations, persons" WHERE="id1 = '[#ID]' AND id2 = persons.id AND nature = 'G' AND type = '[#TYPE]'" ORDER="degree">
    <BEFORE>
      <div class="ckl-personnes" data-type="[#TYPE]">
    </BEFORE>
    <DO>
      <IF COND="[#COUNT] GE 2">
  			<IF COND="[#COUNT] LT [#NBRESULTS]">, <ELSE/> et </IF>
  		</IF>
  		<span class="ckl-personne" data-type="[#TYPE]" data-id="[#ID]">
        <span class="ckl-personne-firstname">[#G_FIRSTNAME]</span>
        <span class="ckl-personne-familyname">[#G_FAMILYNAME]</span>
      </span>
    </DO>
    <AFTER>
      </div>
    </AFTER>
	</LOOP>
</DEFFUNC>
