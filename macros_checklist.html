<CONTENT VERSION="1.0" LANG="fr" CHARSET="utf-8"/>

/**
 * Checklist main.
 */
<DEFMACRO NAME="CKL_MAIN">
  <USE MACROFILE="macros_checklist_article.html"/>
  <USE MACROFILE="macros_checklist_index.html"/>
  <USE MACROFILE="macros_checklist_publication.html"/>

  <MACRO NAME="CKL_HTML_START"/>

  <LOOP NAME="ckl_main"
        TABLE="entities, types"
        SELECT="id, class, type"
        WHERE="id = '[#DOCUMENT]' AND class IN ('publications', 'textes', 'indexes', 'auteurs') AND entities.idtype = types.id">
      <DO>
        <IF COND="[#CLASS] EQ 'textes'">
          <MACRO NAME="CKL_A_MAIN"/>
        <ELSEIF COND="[#CLASS] EQ 'publications'"/>
          <MACRO NAME="CKL_P_MAIN"/>
        <ELSE/>
          <MACRO NAME="CKL_I_MAIN"/>
        </IF>
      </DO>
      <ALTERNATIVE>
        <p>Document not found.</p>
      </ALTERNATIVE>
  </LOOP>

  <MACRO NAME="CKL_HTML_END"/>
</DEFMACRO>

/**
 * Ouverture de la page HTML.
 */
<DEFMACRO NAME="CKL_HTML_START">
  <!DOCTYPE html>
  <html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>OpenEdition Checklist</title>
    <link rel="stylesheet" href="tpl/css/checklist.css">
  </head>
  <body>
</DEFMACRO>

/**
 * Fermeture de la page HTML.
 */
<DEFMACRO NAME="CKL_HTML_END">
  </body>
  </html>
</DEFMACRO>

/**
 * Afficher le titre d'un champ.
 * TODO: inclure les traductions.
 * @param {string} field - Nom du champ.
 */
<DEFFUNC NAME="CKL_PRINT_FIELD_TITLE" REQUIRED="field">
  <LOOP NAME="ckl_get_field"
        TABLE="tablefields"
        SELECT="name, title, class"
        WHERE="class='[#CLASS]' AND name = '[#FIELD]'"
        LIMIT="0,1">
    <DO>
      <div class="ckl-field-title">[#TITLE]</div>
    </DO>
    <ALTERNATIVE>
      <div class="ckl-field-title">[#FIELD]</div>
    </ALTERNATIVE>
  </LOOP>
</DEFFUNC>

/**
 * Affichage simple d'un champ texte.
 * @param {string} field - Nom du champ (détermine le classname).
 * @param {string} value - Valeur à afficher.
 * @param {boolean} [force] - Forcer l'affichage, même si [#VALUE] est vide.
 */
<DEFFUNC NAME="CKL_FIELD_STRING" REQUIRED="field, value" OPTIONAL="force">
  <IF COND="[#FIELD] AND ([#VALUE] OR [#FORCE])">
    <div class="ckl-field ckl-field-string" data-field="[#FIELD]">
      <FUNC NAME="CKL_PRINT_FIELD_TITLE" FIELD="[#FIELD]"/>
      <div class="ckl-field-value">[#VALUE]</div>
    </div>
  </IF>
</DEFFUNC>

/**
 * Affichage simple d'un champ bool.
 * @param {string} field - Nom du champ (détermine le classname).
 * @param {string} value - Valeur (0/1).
 */
<DEFFUNC NAME="CKL_FIELD_BOOL" REQUIRED="field, value">
  <IF COND="[#VALUE] EQ '1'">
    <LET VAR="symbol">&#x2611;</LET>
  <ELSE/>
    <LET VAR="symbol">&#x2610;</LET>
    <LET VAR="value">0</LET>
  </IF>
  <div class="ckl-field ckl-field-bool" data-field="[#FIELD]" data-value="[#VALUE]">
    <FUNC NAME="CKL_PRINT_FIELD_TITLE" FIELD="[#FIELD]"/>
    <div class="ckl-field-value">[#SYMBOL]</div>
  </div>
</DEFFUNC>

/**
 * Affichage des champs multilingues.
 * @param {string} field - Nom du champ (détermine le classname).
 * @param {string} value - Valeur du champ ml.
 */
<DEFFUNC NAME="CKL_FIELD_ML" REQUIRED="field, value">
  <IF COND="[#VALUE]">
    <div class="ckl-field ckl-field-ml" data-field="[#FIELD]">
      <FUNC NAME="CKL_PRINT_FIELD_TITLE" FIELD="[#FIELD]"/>
      <div class="ckl-field-value">
        <!--[ La loop "mltext" utilise [#VALUE] du contexte ]-->
        <LOOP NAME="mltext">
          <FUNC NAME="CKL_FIELD_ML_ITEM" LANG="[#LANG]" VALUE="[#VALUE]"/>
        </LOOP>
      </div>
    </div>
  </IF>
</DEFFUNC>

/**
 * Affichage simple d'un champ texte dans une liste multilingue.
 * @param {string} lang - Langue de l'item.
 * @param {string} value - Valeur à afficher.
 * @param {boolean} [force] - Forcer l'affichage, même si [#VALUE] est vide.
 */
<DEFFUNC NAME="CKL_FIELD_ML_ITEM" REQUIRED="lang, value" OPTIONAL="force">
  <IF COND="[#LANG] AND ([#VALUE] OR [#FORCE])">
    <div class="ckl-field ckl-field-ml-item" data-lang="[#LANG]">
      <span class="ckl-field-ml-lang">[#LANG]</span>
      <span class="ckl-field-ml-value">[#VALUE]</span>
    </div>
  </IF>
</DEFFUNC>

/**
 * Affiche les personnes liées à l'entité en cours.
 * @param {string} type - Nom du type des personnes.
 */
<DEFFUNC NAME="CKL_PERSONNES" REQUIRED="type">
  <LOOP NAME="ckl_personnes" SELECT="g_firstname, g_familyname" TABLE="relations, persons" WHERE="id1 = '[#ID]' AND id2 = persons.id AND nature = 'G' AND type = '[#TYPE]'" ORDER="degree">
    <BEFORE>
      <div class="ckl-field ckl-personnes" data-type="[#TYPE]">
        <FUNC NAME="CKL_PRINT_FIELD_TITLE" FIELD="[#TYPE]"/>
        <div class="ckl-field-value">
    </BEFORE>
    <DO>
      <IF COND="[#COUNT] GE 2">
        <IF COND="[#COUNT] LT [#NBRESULTS]">, <ELSE/> et </IF>
      </IF>
      <span class="ckl-personne" data-type="[#TYPE]" data-id="[#ID]">
        <span class="ckl-personne-firstname">[#G_FIRSTNAME]</span>
        <span class="ckl-personne-familyname">[#G_FAMILYNAME]</span>
      </span>
    </DO>
    <AFTER>
        </div>
      </div>
    </AFTER>
  </LOOP>
</DEFFUNC>
